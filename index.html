<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GPS Gadget — Live</title>
<style>
  :root { --bg:#000; --fg:#00ffb3; --accent:#00c0ff; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:ui-monospace,monospace;}
  .wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:12px;padding:20px;}
  .screen{width:min(820px,94vw);background:#040404;border:2px solid #0a4;box-shadow:0 0 20px rgba(0,255,180,0.06);padding:24px;border-radius:12px;text-align:center;}
  .digits{font-size:2.4rem;letter-spacing:0.06em;}
  .small{font-size:1rem;color:#9ff;}
  .meta{margin-top:8px;color:#7ff;}
  .controls{margin-top:16px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center;}
  button{background:transparent;border:1px solid #0aa;padding:8px 12px;border-radius:8px;color:var(--fg);font-weight:600;}
  input[type="text"]{padding:8px;border-radius:8px;border:1px solid #0aa;background:#001;}
  .status{margin-top:8px;color:#8f8;font-weight:700;}
</style>
</head>
<body>
  <div class="wrap">
    <div class="screen" role="application" aria-label="GPS Gadget">
      <div class="digits" id="lat">Lat: —</div>
      <div class="digits" id="lon">Lon: —</div>
      <div class="digits" id="alt">Alt: —</div>
      <div class="small" id="acc">Accuratezza: —</div>
      <div class="meta" id="time">—</div>

      <div class="controls">
        <button id="startBtn">Avvia</button>
        <button id="stopBtn" disabled>Ferma</button>
        <button id="copyBtn">Copia valori</button>
      </div>

      <div class="status" id="status">Premi "Avvia" per chiedere il permesso GPS.</div>
    </div>
  </div>

<script>
(() => {
  const latEl = document.getElementById('lat');
  const lonEl = document.getElementById('lon');
  const altEl = document.getElementById('alt');
  const accEl = document.getElementById('acc');
  const timeEl = document.getElementById('time');
  const statusEl = document.getElementById('status');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const copyBtn = document.getElementById('copyBtn');

  let watchId = null;
  const opts = { enableHighAccuracy: true, maximumAge: 0, timeout: 10000 };

  function formatNum(n, digits=6){ return (typeof n === 'number') ? n.toFixed(digits) : '—'; }

  function onPos(pos){
    const c = pos.coords;
    latEl.textContent = 'Lat: ' + formatNum(c.latitude, 6);
    lonEl.textContent = 'Lon: ' + formatNum(c.longitude, 6);
    altEl.textContent = 'Alt: ' + (c.altitude === null ? 'N/D' : formatNum(c.altitude, 2) + ' m');
    accEl.textContent = 'Accuratezza: ' + (c.accuracy ? c.accuracy.toFixed(1) + ' m' : '—');
    timeEl.textContent = 'Ultimo aggiornamento: ' + new Date(pos.timestamp).toLocaleTimeString();
    statusEl.textContent = 'Posizione aggiornata';
    // se vuoi trasmettere questa posizione a un server, metti qui la chiamata fetch/WebSocket/Firebase
    if (window.broadcastPosition && typeof window.broadcastPosition === 'function') {
      try { window.broadcastPosition({lat:c.latitude, lon:c.longitude, alt:c.altitude, acc:c.accuracy, ts: pos.timestamp}); } catch(e){ /* ignore */ }
    }
  }

  function onError(err){
    statusEl.textContent = 'Errore GPS: ' + (err && err.message ? err.message : 'sconosciuto');
  }

  startBtn.addEventListener('click', () => {
    if (!('geolocation' in navigator)) {
      alert('Il tuo browser non supporta la Geolocation API.');
      return;
    }
    statusEl.textContent = 'Richiedo permesso...';
    watchId = navigator.geolocation.watchPosition(onPos, onError, opts);
    startBtn.disabled = true;
    stopBtn.disabled = false;
  });

  stopBtn.addEventListener('click', () => {
    if (watchId !== null) {
      navigator.geolocation.clearWatch(watchId);
      watchId = null;
    }
    statusEl.textContent = 'Tracciamento fermo.';
    startBtn.disabled = false;
    stopBtn.disabled = true;
  });

  copyBtn.addEventListener('click', async () => {
    const text = `${latEl.textContent} | ${lonEl.textContent} | ${altEl.textContent}`;
    try { await navigator.clipboard.writeText(text); statusEl.textContent = 'Valori copiati negli appunti.'; }
    catch(e){ statusEl.textContent = 'Copia non riuscita.'; }
  });

})();
</script>
</body>
</html>
